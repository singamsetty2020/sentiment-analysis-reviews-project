<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --bg1:#1a2a6c; --bg2:#16222a; --bg3:#0f2027;
      --card-bg: rgba(255,255,255,0.08);
      --accent: #667eea;
      --accent-dark:#5a67d8;
      --danger: #ff4d4d;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
      color: #fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .page-wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .login-card{
      width:100%;
      max-width:420px;
      background: var(--card-bg);
      border-radius:14px;
      padding:32px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.55);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.03);
    }

    .login-card h2{
      margin:0 0 12px 0;
      font-weight:700;
      letter-spacing: -0.5px;
      font-size:1.6rem;
    }

    .login-desc{
      color:#d0d6e0;
      margin-bottom:18px;
      font-size:0.95rem;
    }

    .form-control{
      border-radius:10px;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.04);
      color: #fff;
      padding:11px 12px;
      transition: all .18s ease;
    }
    .form-control::placeholder{ color: rgba(255,255,255,0.5); }
    .form-control:focus{
      outline:none;
      border-color: var(--accent);
      box-shadow: 0 6px 18px rgba(102,126,234,0.12);
      background: rgba(255,255,255,0.06);
    }

    .btn-login{
      width:100%;
      border-radius:10px;
      padding:12px;
      font-weight:600;
      font-size:1rem;
      background: linear-gradient(90deg,var(--accent),#764ba2);
      border:none;
      color:#fff;
      transition: transform .18s ease, box-shadow .18s ease;
      margin-top:6px;
    }
    .btn-login:hover{
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 10px 30px rgba(102,126,234,0.18);
    }

    .link-row{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-size:0.95rem;
    }
    .link-row a { color:#ffca28; text-decoration:none; }
    .link-row a:hover{ color:#fff; }

    /* inline error messages */
    .error-message{
      color: var(--danger);
      font-size:0.88rem;
      margin-top:6px;
      text-align:left;
    }

    /* server flash area */
    .server-error {
      margin-top:14px;
      padding:10px 12px;
      background: rgba(255,77,77,0.08);
      border-left: 4px solid rgba(255,77,77,0.9);
      color: #ffd7d7;
      border-radius:8px;
      font-size:0.95rem;
    }

    /* small helper */
    .small-muted { color:#c1c7d1; font-size:0.9rem; }

    /* responsive */
    @media (max-width:600px){
      .login-card{ padding:22px; max-width: 92%; }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="login-card" role="main">
      <h2>üîë Sign in</h2>
      <div class="login-desc">Welcome back ‚Äî enter your credentials to access your dashboard.</div>

      <!-- Server-side flashed messages (login failures etc.) -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, msg in messages %}
            {% if category == 'danger' %}
              <div class="server-error" id="serverError">{{ msg }}</div>
            {% else %}
              <!-- other categories (success/info) -->
              <div class="server-error" style="background: rgba(40,167,69,0.08); border-left-color: rgba(40,167,69,0.9); color:#dfffe6;">
                {{ msg }}
              </div>
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endwith %}

      <!-- FORM -->
      <form method="post" onsubmit="return validateLogin()">
        <div class="mb-3">
          <label class="form-label small-muted">Email</label>
          <input id="email" name="email" type="email" class="form-control" placeholder="you@example.com" autofocus>
          <div id="emailError" class="error-message"></div>
        </div>

        <div class="mb-2">
          <label class="form-label small-muted">Password</label>
          <input id="password" name="password" type="password" class="form-control" placeholder="Your password">
          <div id="passwordError" class="error-message"></div>
        </div>

        <button type="submit" class="btn-login">Login</button>

        <div class="link-row">
          <a href="{{ url_for('register') }}">Don't have an account? Register</a>
          <a href="{{ url_for('index') }}">üè† Home</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    // clear server error when user starts typing
    document.addEventListener('input', () => {
      const server = document.getElementById('serverError');
      if(server && server.innerText.trim() !== '') {
        // do not remove server error until user changes inputs; remove silently on first input
        server.style.display = 'none';
      }
    });

    function validateLogin(){
      // clear previous errors
      document.getElementById('emailError').innerText = '';
      document.getElementById('passwordError').innerText = '';

      let ok = true;
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if(email === ''){
        document.getElementById('emailError').innerText = 'Email is required.';
        ok = false;
      } else {
        // basic email format check
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if(!re.test(email)){
          document.getElementById('emailError').innerText = 'Enter a valid email address.';
          ok = false;
        }
      }

      if(password === ''){
        document.getElementById('passwordError').innerText = 'Password is required.';
        ok = false;
      }

      return ok; // if false, form won't submit
    }

    // if the server returned a flashed 'danger' message it will be visible in the server-error block.
    // Client-side input hides server message on first edit (see input listener above).
  </script>

  <!-- bootstrap bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
